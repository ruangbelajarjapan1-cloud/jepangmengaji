<!doctype html>
<html lang="id" data-theme="light" id="top">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Jepang Mengaji ‚Äî Mengaji sesuai Sunnah, Berdakwah, Berkontribusi</title>
  <meta name="description" content="Artikel keislaman, info kajian, live YouTube, dan donasi kegiatan dakwah di Jepang." />
  <link rel="icon" href="jm.jpeg" />
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">
  <script>(function(){try{var t=localStorage.getItem('jm-theme'); if(t) document.documentElement.setAttribute('data-theme', t);}catch(e){}})();</script>
  <style>
    :root{--bg:#fff;--bg-soft:#f8fafc;--text:#0f172a;--muted:#475569;--card:#fff;--border:#e2e8f0;--primary:#3b82f6;--accent:#22c55e;--danger:#ef4444;--shadow:0 10px 25px rgba(2,6,23,.08)}
    [data-theme="dark"]{--bg:#0f172a;--bg-soft:#111827;--text:#e5e7eb;--muted:#94a3b8;--card:#111827;--border:#1f2937;--shadow:0 10px 30px rgba(0,0,0,.25)}

    html,body{height:100%}
    body{margin:0;font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,"Noto Sans",sans-serif;color:var(--text);background:var(--bg)}
    body::before{content:""; position:fixed; inset:0; z-index:-1;
      background:linear-gradient(rgba(255,255,255,0.86), rgba(255,255,255,0.86)), url("https://images.unsplash.com/photo-1523217582562-09d0def993a6?auto=format&fit=crop&w=1920&q=80") center/cover no-repeat}
    [data-theme="dark"] body::before{background:linear-gradient(rgba(15,23,42,.80), rgba(15,23,42,.90)), url("https://images.unsplash.com/photo-1523217582562-09d0def993a6?auto=format&fit=crop&w=1920&q=80") center/cover no-repeat}

    a{text-decoration:none;color:inherit}
    img{max-width:100%;display:block}
    .container{max-width:1120px;margin:0 auto;padding:0 1rem}

    .btn{display:inline-flex;align-items:center;gap:.5rem;padding:.6rem .9rem;border:1px solid var(--border);border-radius:.7rem;cursor:pointer;background:var(--card);color:var(--text);transition:transform .15s}
    .btn:hover{transform:translateY(-1px);box-shadow:var(--shadow)}
    .btn.primary{background:var(--primary);color:#fff;border-color:var(--primary)}
    .btn.soft{background:transparent;color:var(--primary);border-color:var(--primary)}
    .badge{padding:.1rem .4rem;font-size:.75rem;background:rgba(148,163,184,.25);border:1px solid var(--border);border-radius:.4rem;white-space:nowrap}

    /* ===== NAVBAR RAPIH ===== */
    .nav{position:sticky;top:0;z-index:40;background:color-mix(in oklab,var(--bg) 85%, transparent);backdrop-filter:blur(8px);border-bottom:1px solid var(--border)}
    .nav-inner{display:flex;gap:1rem;align-items:center;padding:.65rem 0}
    .brand{display:flex;align-items:center;gap:.6rem;min-width:0}
    .brand .logo{height:40px;border-radius:.5rem;background:#fff;box-shadow:var(--shadow)}
    [data-theme="dark"] .brand .logo{background:#0b1220}

    .nav-center{flex:1;display:flex;justify-content:center}
    .nav-links{display:flex;align-items:center;gap:1rem;flex-wrap:nowrap;overflow:auto;-webkit-overflow-scrolling:touch;scrollbar-width:none}
    .nav-links::-webkit-scrollbar{display:none}
    .nav-links a{padding:.35rem .4rem;border-radius:.5rem;white-space:nowrap;border:1px solid transparent}
    .nav-links a:hover{background:color-mix(in oklab,var(--bg-soft) 60%, transparent);border-color:var(--border)}

    .nav-right{display:flex;align-items:center;gap:.5rem}
    .nav-search{display:none}
    .nav-toggle{display:inline-flex;align-items:center;justify-content:center;width:38px;height:38px;border:1px solid var(--border);border-radius:.6rem;background:var(--card);cursor:pointer}
    @media(min-width:900px){
      .nav-center{justify-content:flex-start}
      .nav-search{display:block}
      .nav-toggle{display:none}
    }
    /* mobile drawer */
    #drawer{display:none}
    #drawer.open{display:block;position:fixed;inset:64px 0 auto 0;background:var(--card);border-bottom:1px solid var(--border);box-shadow:var(--shadow);z-index:30}
    #drawer .menu{display:grid;grid-template-columns:1fr 1fr;gap:.5rem;padding:.7rem 1rem}
    #drawer a{padding:.6rem .8rem;border:1px solid var(--border);border-radius:.6rem;text-align:center}

    .hero{padding:3rem 0;background:linear-gradient(180deg,color-mix(in oklab,var(--primary) 10%,transparent),transparent)}
    .grid{display:grid;gap:1rem}
    .grid-2{grid-template-columns:1fr}
    .grid-3{grid-template-columns:1fr}
    @media(min-width:768px){.grid-2{grid-template-columns:1fr 1fr}.grid-3{grid-template-columns:repeat(3,1fr)}}
    .card{background:var(--card);border:1px solid var(--border);border-radius:1rem;box-shadow:var(--shadow)}
    .card>.p{padding:1rem}
    .section{padding:2.2rem 0}
    .muted{color:var(--muted)}
    .aspect-video{position:relative;padding-top:56.25%;background:var(--bg-soft);border:1px solid var(--border);border-radius:1rem;overflow:hidden}
    .aspect-video>*{position:absolute;inset:0;width:100%;height:100%}
    .flex{display:flex;gap:.5rem;align-items:center}
    .right{margin-left:auto}
    .space{height:1rem}
    .input{padding:.45rem .6rem;border:1px solid var(--border);border-radius:.6rem;background:var(--card);color:var(--text)}
    #backTop{position:fixed;bottom:20px;right:20px;z-index:50;width:44px;height:44px;border:none;border-radius:50%;background:var(--primary);color:#fff;cursor:pointer;box-shadow:var(--shadow);display:none;font-size:18px}
    #backTop:hover{transform:translateY(-2px)}

    /* kontak layout */
    .section.contact .container{align-items:start}
    .section.contact .grid-2{gap:1rem}
    .section.contact form .input{width:100%;box-sizing:border-box}
    .section.contact form .actions{display:flex;gap:.5rem;flex-wrap:wrap}
    @media(min-width:992px){.section.contact .grid-2{grid-template-columns:1.25fr .75fr}}

    .video-thumb{border-radius:.7rem;overflow:hidden;border:1px solid var(--border)}

    /* ===== INFO TERBARU ===== */
    .info-grid .poster{display:block;border:1px solid var(--border);border-radius:.7rem;overflow:hidden;background:var(--bg-soft)}
    .info-grid .poster img{width:100%;height:240px;object-fit:cover}
    .info-grid .post-card{background:var(--card);border:1px solid var(--border);border-radius:1rem;box-shadow:var(--shadow)}
    .info-grid .post-card .p{padding:1rem}
    .info-body{line-height:1.75;white-space:normal;text-wrap:pretty;word-break:break-word}
    .info-body p{margin:.35rem 0}
    .info-body ul{margin:.35rem 0 .55rem 1.2rem;padding:0}
    .info-body li{margin:.2rem 0}
    .info-body a{text-decoration:underline}

    /* credit badge */
    .credit{
      padding:.25rem .6rem;
      border:1px solid var(--border);
      border-radius:.55rem;
      background:color-mix(in oklab,var(--bg-soft) 60%, transparent);
      font-size:.9rem;
    }
  </style>
</head>
<body>
  <!-- NAVBAR -->
  <header class="nav">
    <div class="container nav-inner">
      <button class="nav-toggle" id="navToggle" aria-label="Menu">‚ò∞</button>

      <div class="brand">
        <img src="jm.jpeg" alt="Logo" class="logo" />
        <div style="display:flex;flex-direction:column;line-height:1.1">
          <a href="#top" style="font-size:1.05rem;font-weight:700">Jepang Mengaji</a>
          <span class="badge">„Ç≥„Éü„É•„Éã„ÉÜ„Ç£</span>
        </div>
      </div>

      <div class="nav-center">
        <nav class="nav-links" aria-label="Navigasi utama">
          <a href="#info">Info Terbaru</a>
          <a href="#artikel">Artikel</a>
          <a href="#kajian">Info Kajian</a>
          <a href="#live">Live</a>
          <a href="live.html">Halaman Live</a>
          <a href="arsip.html">Arsip</a>
          <a href="#donasi">Donasi</a>
          <a href="#tentang">Tentang</a>
          <a href="#kontak">Kontak</a>
        </nav>
      </div>

      <div class="nav-right">
        <form id="navSearch" class="nav-search" onsubmit="event.preventDefault();var q=this.q.value.trim();location.href='arsip.html'+(q?('?q='+encodeURIComponent(q)):'');">
          <input name="q" type="search" placeholder="Cari‚Ä¶ (mis. akidah)" class="input" style="width:180px"/>
        </form>
        <button class="btn soft" id="themeToggle" aria-label="Toggle theme">üåó</button>
        <a class="btn primary" href="#donasi">‚ù§Ô∏è Donasi</a>
      </div>
    </div>

    <!-- drawer mobile -->
    <div id="drawer">
      <div class="menu">
        <a href="#info">Info Terbaru</a>
        <a href="#artikel">Artikel</a>
        <a href="#kajian">Info Kajian</a>
        <a href="#live">Live</a>
        <a href="live.html">Halaman Live</a>
        <a href="arsip.html">Arsip</a>
        <a href="#donasi">Donasi</a>
        <a href="#tentang">Tentang</a>
        <a href="#kontak">Kontak</a>
      </div>
      <div style="padding:.5rem 1rem;border-top:1px solid var(--border)">
        <form onsubmit="event.preventDefault();var q=this.q.value.trim();location.href='arsip.html'+(q?('?q='+encodeURIComponent(q)):'');">
          <input name="q" type="search" placeholder="Cari‚Ä¶ (mis. akidah)" class="input" style="width:100%"/>
        </form>
      </div>
    </div>
  </header>

  <!-- HERO -->
  <section class="hero">
    <div class="container grid grid-2" style="align-items:center;gap:1.5rem">
      <div>
        <h1>Mengaji sesuai Sunnah, <span style="color:var(--primary)">Berdakwah</span>, Berkontribusi</h1>
        <p class="muted">Artikel, info kajian sunnah, live YouTube, dan donasi kegiatan dakwah di Jepang.</p>
        <div class="flex" style="flex-wrap:wrap;gap:.5rem">
          <a class="btn primary" href="#kajian">üìÖ Lihat Kajian</a>
          <a class="btn" href="#info">üÜï Info Terbaru</a>
          <a class="btn" href="#artikel">üìñ Artikel</a>
          <a class="btn" href="live.html">‚ñ∂Ô∏è Live</a>
          <a class="btn" href="arsip.html">üóÇÔ∏è Arsip</a>
        </div>
      </div>
      <div class="card"><div class="p">
        <h3>Live / Video Terbaru</h3>
        <div class="aspect-video" id="livePlayer"><div class="center muted">Memuat‚Ä¶</div></div>
        <div class="space"></div>
        <div class="flex"><input id="ytId" class="input" placeholder="Masukkan YouTube Video ID/URL (kosongkan untuk video terbaru)"/><button class="btn" id="applyId">Terapkan</button></div>
      </div></div>
    </div>
  </section>

  <!-- INFO TERBARU -->
  <section id="info" class="section" style="background:var(--bg-soft)">
    <div class="container">
      <div class="flex" style="align-items:center">
        <h2>Info Terbaru</h2>
        <a class="btn right" href="#kontak">‚ûï Kirim Info</a>
      </div>
      <div id="infos" class="grid grid-3 info-grid"></div>
    </div>
  </section>

  <!-- ARTIKEL -->
  <section id="artikel" class="section">
    <div class="container"><h2>Artikel Terbaru</h2><div id="articles" class="grid grid-3"></div></div>
  </section>

  <!-- KAJIAN -->
  <section id="kajian" class="section" style="background:var(--bg-soft)">
    <div class="container"><h2>Info Kajian</h2><div id="kajians" class="grid grid-3"></div></div>
  </section>

  <!-- LIVE PREVIEW -->
  <section id="live" class="section">
    <div class="container grid grid-2">
      <div class="card"><div class="p"><h3>Player</h3><div class="aspect-video" id="livePlayer2"><div class="center muted">Memuat‚Ä¶</div></div></div></div>
      <div class="card"><div class="p">
        <h3>Pengumuman Live</h3>
        <p class="muted">InsyaAllah Sabtu, 19:30 JST. Tema: Akidah 1.</p>
        <div class="space"></div>
        <a class="btn primary" href="live.html">üî¥ Buka Halaman Live</a>
      </div></div>
    </div>
  </section>

  <!-- VIDEO TERBARU GRID -->
  <section class="section" style="background:var(--bg-soft)">
    <div class="container">
      <div class="flex" style="align-items:center">
        <h2>Video Terbaru</h2>
        <a class="btn right" href="arsip.html">üóÇÔ∏è Lihat Semua Arsip</a>
      </div>
      <div id="videosHome" class="grid grid-3"></div>
    </div>
  </section>

  <!-- DONASI -->
  <section id="donasi" class="section">
    <div class="container">
      <h2>Donasi</h2>
      <div class="grid grid-2">
        <article class="card" id="donasi-dauroh"><div class="p">
          <h3>‚ù§Ô∏è Donasi Dauroh</h3>
          <p class="muted">Dukung penyelenggaraan dauroh (pemateri, tempat, konsumsi, dokumentasi).</p>
          <h4>Nomor Rekening</h4>
          <ul class="muted" style="margin-top:.2rem;line-height:1.7">
            <li><strong>SMBC Indonesia / Jenius</strong> a.n. <em>Wahyu Setiawan</em> ‚Äî <strong>90220139952</strong></li>
            <li><strong>yucho ginko</strong> a.n. <em>„Éà„É™„Çµ„É≥„Éú„Éâ</em> ‚Äî <strong>14660-20688191</strong></li>
          </ul>
          <div class="space"></div>
          <div class="flex" style="flex-wrap:wrap;gap:.5rem">
            <a class="btn primary" href="donasi-dauroh.html">üí≥ Link Donasi</a>
            <a class="btn" href="https://wa.me/817084810427?text=Assalamu%27alaikum%2C%20saya%20konfirmasi%20%2F%20bertanya%20Donasi%20Dauroh.%0ANama%3A%20-%0AJumlah%3A%20-%0ATanggal%3A%20-%0ATransfer%20ke%20(REK)%3A%20-%0A" target="_blank" rel="noopener">‚úÖ Konfirmasi via WhatsApp</a>
            <a class="btn" href="#kontak">üìû Kontak Panitia</a>
          </div>
        </div></article>

        <article class="card" id="donasi-masjid"><div class="p">
          <h3>‚ù§Ô∏è Donasi Masjid</h3>
          <p class="muted">Untuk renovasi/operasional, pembelian bangunan masjid & musholla.</p>
          <h4>Nomor Rekening</h4>
          <ul class="muted" style="margin-top:.2rem;line-height:1.7">
            <li><strong>SMBC Indonesia / Jenius</strong> a.n. <em>Wahyu Setiawan</em> ‚Äî <strong>90220139952</strong></li>
            <li><strong>yucho ginko</strong> a.n. <em>„Éà„É™„Çµ„É≥„Éú„Éâ</em> ‚Äî <strong>14660-20688191</strong></li>
          </ul>
          <div class="space"></div>
          <div class="flex" style="flex-wrap:wrap;gap:.5rem">
            <a class="btn primary" href="donasi-masjid.html">üí≥ Link Donasi</a>
            <a class="btn" href="https://wa.me/817084810427?text=Assalamu%27alaikum%2C%20saya%20konfirmasi%20Donasi%20Masjid.%0ANama%3A%20-%0ANominal%3A%20-%0ATanggal%3A%20-%0ATransfer%20ke%3A%20(SMBC%20%2F%20Yucho)" target="_blank" rel="noopener">‚úÖ Konfirmasi via WhatsApp</a>
            <a class="btn" href="#kontak">üìû Kontak Panitia</a>
          </div>
        </div></article>
      </div>
    </div>
  </section>

  <!-- NEWSLETTER -->
  <section class="section">
    <div class="container grid grid-2" style="align-items:center">
      <div><h3>Berlangganan Info</h3><p class="muted">Dapatkan update artikel & kajian.</p></div>
      <form onsubmit="event.preventDefault();alert('Terima kasih!');" class="grid" style="grid-template-columns:1fr auto;gap:.6rem">
        <input type="email" class="input" placeholder="Email Anda" required/>
        <button class="btn primary">Daftar</button>
      </form>
    </div>
  </section>

  <!-- TENTANG -->
  <section id="tentang" class="section" style="background:var(--bg-soft)">
    <div class="container grid grid-2">
      <div>
        <h2>Tentang Jepang Mengaji</h2>
        <p class="muted">Komunitas Muslim Indonesia (non formal) di Jepang: kajian, dauroh, kelas arab, aksi sosial.</p>
        <ul class="muted" style="line-height:1.7;margin:.5rem 0 0">
          <li>Terbuka untuk ikhwan & akhwat.</li>
          <li>Info kegiatan di Whatsapp Grup & kanal sosial.</li>
          <li>Bahasa utama: Indonesia</li>
        </ul>
      </div>

      <div class="card"><div class="p">
        <h3>Gabung Komunitas</h3>
        <div class="flex" style="flex-wrap:wrap;gap:.5rem;margin:.5rem 0 1rem">
          <a class="btn primary" href="https://chat.whatsapp.com/Fg2UKlhT5s9B7oYeTsMMKO?mode=ac_t" target="_blank" rel="noopener">üì≤ Whatsapp Group</a>
          <a class="btn" href="https://t.me/jepangmengaji_channel" target="_blank" rel="noopener">üì£ Telegram Channel</a>
          <a class="btn" href="https://www.youtube.com/@jepangmengaji1390" target="_blank" rel="noopener">‚ñ∂Ô∏è YouTube</a>
          <a class="btn" href="https://www.instagram.com/jepangmengaji/?hl=en" target="_blank" rel="noopener">üì∑ Instagram</a>
        </div>

        <details id="pedoman">
          <summary role="button" tabindex="0">Pedoman singkat anggota <span class="chev">‚ñæ</span></summary>
          <div class="content">
            <ul class="muted" style="line-height:1.7;margin:.2rem 0 0">
              <li>Jaga adab & hindari debat.</li>
              <li>Promosi/jualan perlu izin admin.</li>
              <li>Jaga privasi dan data anggota.</li>
            </ul>
          </div>
        </details>
      </div></div>
    </div>
  </section>

  <!-- KONTAK -->
  <section id="kontak" class="section contact">
    <div class="container grid grid-2">
      <div>
        <h2>Kontak Panitia</h2>
        <p class="muted">Ada pertanyaan seputar kajian atau donasi? Kirim pesan melalui form atau hubungi kontak di samping.</p>
        <form onsubmit="event.preventDefault();alert('Pesan terkirim');">
          <div class="grid" style="grid-template-columns:1fr 1fr;gap:.6rem">
            <input class="input" placeholder="Nama" required/>
            <input class="input" type="email" placeholder="Email" required/>
          </div>
          <input class="input" placeholder="Subjek (mis. Donasi Dauroh / Donasi Masjid / Info Kajian)" required style="margin-top:.6rem"/>
          <textarea class="input" rows="4" placeholder="Pesan" style="margin-top:.6rem"></textarea>
          <div class="actions" style="margin-top:.6rem">
            <a class="btn" href="#donasi-dauroh">‚Üó Donasi Dauroh</a>
            <a class="btn" href="#donasi-masjid">‚Üó Donasi Masjid</a>
            <button class="btn primary" type="submit">Kirim</button>
          </div>
        </form>
      </div>

      <aside class="card"><div class="p">
        <h3>Kontak Langsung & Konfirmasi</h3>
        <ul class="muted" style="margin-top:.2rem;line-height:1.9">
          <li>
            <strong>CP Donasi Dauroh ‚Äî Akhi Tri Sambodo</strong><br/>
            <a href="https://wa.me/817084810427?text=Assalamu%27alaikum%2C%20saya%20ingin%20konfirmasi%20Donasi%20Dauroh.%0ANama%3A%20-%0ANominal%3A%20-%0ATanggal%3A%20-%0ATransfer%20ke%3A%20(SMBC%20%2F%20Yucho)" target="_blank" rel="noopener">WhatsApp</a> ¬∑
            <a href="tel:+817084810427">Telp</a>
          </li>
          <li>
            <strong>CP Donasi Masjid ‚Äî Akhi Tri Sambodo</strong><br/>
            <a href="https://wa.me/817084810427?text=Assalamu%27alaikum%2C%20saya%20ingin%20konfirmasi%20Donasi%20Masjid.%0ANama%3A%20-%0ANominal%3A%20-%0ATanggal%3A%20-%0ATransfer%20ke%3A%20(SMBC%20%2F%20Yucho)" target="_blank" rel="noopener">WhatsApp</a> ¬∑
            <a href="tel:+817084810427">Telp</a>
          </li>
          <li>‚úâÔ∏è Email Panitia ‚Äî <a href="mailto:jepangmengaji@gmail.com">jepangmengaji@gmail.com</a></li>
        </ul>
      </div></aside>
    </div>
  </section>

  <!-- FOOTER -->
  <footer class="footer">
    <div class="container" style="padding:1rem 0;display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap">
      <div class="flex" style="gap:.5rem">
        <img src="jm.jpeg" alt="Logo" style="height:24px;border-radius:.25rem"/>
        <span class="muted">¬© <span id="year"></span> Jepang Mengaji</span>
      </div>
      <div class="flex" style="gap:1rem;align-items:center">
        <span class="muted credit">Design by Wahyu</span>
        <a class="muted" href="arsip.html">Arsip</a>
        <a class="muted" href="#">Privasi</a>
        <a class="muted" href="#">Ketentuan</a>
        <a class="muted" href="#top">Kembali ke Atas</a>
      </div>
    </div>
  </footer>

  <!-- Back to Top -->
  <button id="backTop" title="Kembali ke atas">‚¨Ü</button>

  <script>
    /* ====== NAV drawer ====== */
    const navToggle=document.getElementById('navToggle');
    const drawer=document.getElementById('drawer');
    if(navToggle){ navToggle.addEventListener('click',()=>{ drawer.classList.toggle('open'); }); }
    document.addEventListener('click',e=>{
      if(drawer.classList.contains('open') && !e.target.closest('#drawer') && !e.target.closest('#navToggle')) drawer.classList.remove('open');
    });

    /* ====== DATA SHEETS ====== */
    const ARTICLES_CSV_URL="https://docs.google.com/spreadsheets/d/e/2PACX-1vQiIOueuc-YygpdulT9x9ZjJUA2jlaWXu2uGzwgHcugNebW5HLjR66luq3kHmqDvTmNJlSjpjsIQ6PG/pub?gid=0&single=true&output=csv";
    const KAJIAN_CSV_URL="https://docs.google.com/spreadsheets/d/e/2PACX-1vQiIOueuc-YygpdulT9x9ZjJUA2jlaWXu2uGzwgHcugNebW5HLjR66luq3kHmqDvTmNJlSjpjsIQ6PG/pub?gid=450885199&single=true&output=csv";
    const INFO_CSV_URL="https://docs.google.com/spreadsheets/d/e/2PACX-1vQiIOueuc-YygpdulT9x9ZjJUA2jlaWXu2uGzwgHcugNebW5HLjR66luq3kHmqDvTmNJlSjpjsIQ6PG/pub?gid=1656910010&single=true&output=csv";
    const INFO_HIGHLIGHT_COUNT=3;

    /* ====== YOUTUBE CONFIG ====== */
    const CHANNEL_ID = "UC3h0lpsfwETKD9v2mY6WVTQ";
    const CHANNEL_LIVE_EMBED = `https://www.youtube.com/embed/live_stream?channel=${CHANNEL_ID}`;
    const FEED = `https://www.youtube.com/feeds/videos.xml?channel_id=${CHANNEL_ID}`;
    const RSS2JSON = "https://api.rss2json.com/v1/api.json?rss_url=";

    // theme toggle
    document.getElementById('themeToggle').addEventListener('click',()=>{
      const cur=document.documentElement.getAttribute('data-theme')==='light'?'dark':'light';
      document.documentElement.setAttribute('data-theme',cur);
      localStorage.setItem('jm-theme',cur);
    });
    // year & back-to-top
    document.getElementById('year').textContent=new Date().getFullYear();
    const backBtn=document.getElementById('backTop');
    window.addEventListener('scroll',()=>{backBtn.style.display=window.scrollY>300?'block':'none'});
    backBtn.addEventListener('click',()=>window.scrollTo({top:0,behavior:'smooth'}));

    // ==== Utils
    function extractYouTubeId(input){
      const m = String(input||'').match(/(?:v=|youtu\.be\/|embed\/)([A-Za-z0-9_-]{11})/);
      return m ? m[1] : '';
    }
    function mountIframeBySrc(id,src){
      const el=document.getElementById(id);
      el.innerHTML = src
        ? `<iframe src="${src}" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>`
        : '<div class="center muted">Belum ada Live aktif</div>';
    }
    function mountByVideoId(id,vid){ mountIframeBySrc(id, vid ? `https://www.youtube.com/embed/${vid}` : ""); }

    // Ambil ID video terbaru (RSS‚Üírss2json)
    async function fetchLatestVideoId(){
      const res = await fetch(RSS2JSON + encodeURIComponent(FEED) + `&_=${Date.now()}`);
      const data = await res.json();
      const first = (data && Array.isArray(data.items) && data.items[0]) ? data.items[0] : null;
      if(!first) return null;
      return (first.link.split("v=")[1]||"").slice(0,11) || null;
    }
    async function mountLatestVideo(){
      try{
        const id = await fetchLatestVideoId();
        if(id){
          mountByVideoId('livePlayer', id);
          mountByVideoId('livePlayer2', id);
          const inp = document.getElementById('ytId');
          if (inp) inp.value = `https://www.youtube.com/watch?v=${id}`;
          return;
        }
      }catch(e){ console.warn('Gagal ambil video terbaru:', e); }
      mountIframeBySrc('livePlayer', CHANNEL_LIVE_EMBED);
      mountIframeBySrc('livePlayer2', CHANNEL_LIVE_EMBED);
    }
    mountLatestVideo();

    // input manual override
    const ytInput = document.getElementById('ytId');
    const applyBtn = document.getElementById('applyId');
    if (ytInput && applyBtn){
      applyBtn.addEventListener('click', ()=>{
        const raw = ytInput.value.trim();
        if (!raw){ mountLatestVideo(); return; }
        const vid = extractYouTubeId(raw);
        if (vid && vid.length===11){
          mountByVideoId('livePlayer', vid);
          mountByVideoId('livePlayer2', vid);
        } else {
          alert("URL/ID YouTube tidak valid. Contoh: https://www.youtube.com/watch?v=XXXXXXXXXXX");
        }
      });
    }

    // ==== CSV helpers (robust)
    async function fetchCSV(url){
      const res=await fetch(url+(url.includes('?')?'&':'?')+'_'+Date.now());
      const text=(await res.text()).replace(/^\uFEFF/,'');
      const rows=[];let row=[],cell='',inQuotes=false;
      for(let i=0;i<text.length;i++){
        const c=text[i],n=text[i+1];
        if(c=='"'){ if(inQuotes&&n=='"'){cell+='"';i++;} else inQuotes=!inQuotes; }
        else if(c===','&&!inQuotes){row.push(cell);cell='';}
        else if((c==='\n'||(c==='\r'&&n==='\n'))&&!inQuotes){ if(c==='\r') i++; row.push(cell); cell=''; if(row.length) rows.push(row); row=[]; }
        else { cell+=c; }
      }
      if(cell||row.length){row.push(cell);rows.push(row)}
      const header=(rows.shift()||[]).map(h=>h.trim());
      return rows.map(r=>Object.fromEntries(header.map((h,i)=>[h,(r[i]||'').trim()])));
    }
    function pick(obj, keys){
      for(const k of keys){ const v=obj[k]; if(v && String(v).trim()) return String(v).trim(); }
      return '';
    }

    // ==== Article / Kajian normalizers
    function normalizeArticleRow(r){
      return {
        title: pick(r, ['title','judul','nama','artikel','article']),
        excerpt: pick(r, ['excerpt','ringkasan','deskripsi','desc','konten','content']),
        date: pick(r, ['date','tanggal','published','tgl']),
        href: pick(r, ['href','link','url'])
      };
    }
    function normalizeKajianRow(r){
      return {
        judul: pick(r, ['judul','title','tema','materi']),
        ustadz: pick(r, ['ustadz','pemateri','narasumber']),
        waktu: pick(r, ['waktu','jadwal','tanggal','tgl','date']),
        lokasi: pick(r, ['lokasi','tempat','venue','alamat']),
        mapUrl: pick(r, ['mapUrl','maps','map','link','url'])
      };
    }

    // ==== Info helpers (rapi + gambar dari Drive/IMAGE())
    function escapeHtml(s){return String(s).replace(/[&<>"']/g, m=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"}[m]));}
    function linkify(s){return String(s).replace(/(https?:\/\/[^\s<]+)/g, '<a href="$1" target="_blank" rel="noopener">$1</a>');}
    function formatInfoHTML(text){
      if(!text) return '';
      const lines = String(text).replace(/\r\n/g,'\n').split('\n');
      let html='', inList=false, para=[];
      const flushPara=()=>{ if(para.length){ html += `<p>${linkify(escapeHtml(para.join(' ')))}</p>`; para=[]; } };
      for(const raw of lines){
        const line = raw.trim();
        if(!line){ flushPara(); if(inList){ html+='</ul>'; inList=false; } continue; }
        const m = line.match(/^[-‚Äì‚Ä¢*]\s+(.*)$/);
        if(m){ flushPara(); if(!inList){ html+='<ul>'; inList=true; } html += `<li>${linkify(escapeHtml(m[1]))}</li>`; }
        else { if(inList){ html+='</ul>'; inList=false; } para.push(line); }
      }
      flushPara(); if(inList) html+='</ul>';
      return html;
    }

    function extractUrl(s){
      if(!s) return '';
      const str = String(s);
      // IMAGE("url") ‚Üí ambil dalam tanda kutip pertama
      const imgf = str.match(/IMAGE\(\s*"([^"]+)"/i);
      if(imgf) return imgf[1];
      const m = str.match(/https?:\/\/[^\s"'()<>]+/);
      return m ? m[0] : '';
    }
    function fixImageUrl(u){
      let url = extractUrl(u);
      if(!url) return '';

      // Google Drive ‚Üí direct view
      let m = url.match(/drive\.google\.com\/file\/d\/([a-zA-Z0-9_-]+)/);
      if(m){ return `https://drive.google.com/uc?export=view&id=${m[1]}`; }
      m = url.match(/drive\.google\.com\/open\?id=([^&]+)/);
      if(m){ return `https://drive.google.com/uc?export=view&id=${m[1]}`; }
      m = url.match(/drive\.google\.com\/uc\?id=([^&]+)/);
      if(m){ return `https://drive.google.com/uc?export=view&id=${m[1]}`; }

      return url;
    }
    function sniffFirstImageUrl(row){
      // 1) prioritas kolom khusus
      let u = pick(row, ['gambar','image','img','foto','poster','posterurl','gambarurl','poster_url']);
      if(u) return fixImageUrl(u);
      // 2) cari URL gambar/drive di semua kolom
      for(const v of Object.values(row)){
        const c = extractUrl(v);
        if(!c) continue;
        if(/\.(png|jpe?g|webp|gif)(\?|$)/i.test(c) || /drive\.google\.com|googleusercontent\.com/i.test(c)){
          return fixImageUrl(c);
        }
      }
      // 3) dukung kolom 'driveid'
      const id = pick(row, ['driveid','gdrive','id_gambar']);
      if(id) return `https://drive.google.com/uc?export=view&id=${id}`;
      return '';
    }
    function normalizeInfoRow(r){
      const href = pick(r, ['href','link','url']);
      let gambar = sniffFirstImageUrl(r);

      // Jika belum ada gambar tapi ada link YouTube ‚Üí pakai thumbnail
      if(!gambar && href){
        const yid = extractYouTubeId(href);
        if(yid) gambar = `https://i.ytimg.com/vi/${yid}/hqdefault.jpg`;
      }
      return {
        tipe: String(r.tipe || r.type || '').trim().toLowerCase(),
        judul: String(r.judul || r.title || '').trim(),
        tanggal: String(r.tanggal || r.date || '').trim(),
        gambar,
        konten: String(r.konten || r.content || '').trim(),
        href
      };
    }

    function renderInfos(list){
      const wrap=document.getElementById('infos'); wrap.innerHTML='';
      if(!list.length){
        wrap.innerHTML='<div class="card"><div class="p muted">Belum ada info terbaru.</div></div>';
        return;
      }
      const show = list.slice(0, INFO_HIGHLIGHT_COUNT);

      show.forEach(it=>{
        const d = document.createElement('div');
        const p = document.createElement('div'); p.className='p';

        // Jika poster-only (hanya gambar)
        const posterOnly = !!it.gambar && !it.konten;

        if(posterOnly){
          d.className='card';
          const a = document.createElement('a');
          a.className='poster';
          a.href = it.href || it.gambar;
          if(/^https?:/i.test(a.href)){ a.target='_blank'; a.rel='noopener'; }
          const img = document.createElement('img');
          img.alt = it.judul || 'Poster';
          img.src = it.gambar;
          img.loading='lazy'; img.decoding='async';
          img.onerror=()=>{ img.src='https://picsum.photos/800/500?random=11'; };
          a.appendChild(img);
          const title=document.createElement('h3'); title.style.margin='.6rem 0 .2rem'; title.textContent=it.judul||'Poster';
          const dt=document.createElement('div'); dt.className='muted';
          dt.textContent = it.tanggal ? new Date(it.tanggal).toLocaleDateString('ja-JP',{year:'numeric',month:'short',day:'numeric'}) : '';
          p.appendChild(a); p.appendChild(title); p.appendChild(dt);
          d.appendChild(p);
          wrap.appendChild(d);
          return;
        }

        // Kartu tulisan (jika ada gambar, tampilkan di atas)
        d.className='post-card';
        if(it.gambar){
          const a = document.createElement('a');
          a.className='poster';
          a.href = it.href || it.gambar;
          if(/^https?:/i.test(a.href)){ a.target='_blank'; a.rel='noopener'; }
          const img=document.createElement('img');
          img.alt=it.judul||'Poster'; img.src=it.gambar;
          img.loading='lazy'; img.decoding='async';
          img.onerror=()=>{ img.src='https://picsum.photos/800/500?random=12'; };
          a.appendChild(img);
          p.appendChild(a);
        }
        const title=document.createElement('h3'); title.textContent=it.judul||'Info';
        const ex=document.createElement('div'); ex.className='info-body muted'; ex.innerHTML = formatInfoHTML(it.konten||'');
        const dt=document.createElement('div'); dt.className='muted';
        dt.textContent = it.tanggal ? new Date(it.tanggal).toLocaleDateString('ja-JP',{year:'numeric',month:'short',day:'numeric'}) : '';
        p.appendChild(title); p.appendChild(ex); p.appendChild(dt);
        if(it.href){
          const a=document.createElement('a'); a.className='btn right'; a.href=it.href; a.textContent='Selengkapnya';
          if(/^https?:/i.test(a.href)){ a.target='_blank'; a.rel='noopener'; }
          p.appendChild(a);
        }
        d.appendChild(p);
        wrap.appendChild(d);
      });
    }
    async function loadInfos(){
      try{
        const rows = await fetchCSV(INFO_CSV_URL);
        const items = rows.map(normalizeInfoRow)
                          .filter(x=>x.judul || x.konten || x.gambar)
                          .sort((a,b)=>new Date(b.tanggal||0)-new Date(a.tanggal||0));
        if(items.length){ renderInfos(items); return; }
      }catch(e){ console.warn('Gagal INFO_CSV',e); }
      // fallback sample
      renderInfos([
        {tipe:'poster', judul:'Poster Contoh Kajian', tanggal:new Date().toISOString().slice(0,10), gambar:'https://picsum.photos/800/500?random=1', href:''},
        {tipe:'tulisan', judul:'Perubahan Jadwal Kajian', tanggal:new Date().toISOString().slice(0,10), konten:'Kajian Sabtu diundur menjadi 20:00 JST.'}
      ]);
    }

    // ==== Render Artikel & Kajian + Info
    function renderArticles(list){
      const wrap=document.getElementById('articles'); wrap.innerHTML='';
      if(!list.length){wrap.innerHTML='<div class="card"><div class="p muted">Belum ada artikel / gagal memuat.</div></div>';return}
      list.forEach(a=>{
        const card=document.createElement('article');card.className='card';
        const p=document.createElement('div');p.className='p';
        const h3=document.createElement('h3');h3.textContent=a.title||'';p.appendChild(h3);
        const ex=document.createElement('p');ex.className='muted';ex.textContent=a.excerpt||'';p.appendChild(ex);
        const dt=document.createElement('div');dt.className='muted';dt.textContent=a.date?new Date(a.date).toLocaleDateString('ja-JP',{year:'numeric',month:'short',day:'numeric'}):'';p.appendChild(dt);
        const btn=document.createElement('a');btn.className='btn right';btn.href=a.href||'#';btn.textContent='Baca';if(/^https?:/i.test(btn.href)){btn.target='_blank';btn.rel='noopener'};p.appendChild(btn);
        card.appendChild(p);wrap.appendChild(card);
      });
    }
    function renderKajian(list){
      const wrap=document.getElementById('kajians'); wrap.innerHTML='';
      if(!list.length){wrap.innerHTML='<div class="card"><div class="p muted">Belum ada data kajian / gagal memuat.</div></div>';return}
      list.forEach(k=>{
        const card=document.createElement('article');card.className='card';
        const p=document.createElement('div');p.className='p';
        const h3=document.createElement('h3');h3.textContent=k.judul||'';p.appendChild(h3);
        const u=document.createElement('div');u.className='muted';u.textContent='üë§ '+(k.ustadz||'');p.appendChild(u);
        const w=document.createElement('div');w.className='muted';w.textContent='üóìÔ∏è '+(k.waktu||'');p.appendChild(w);
        const l=document.createElement('div');l.className='muted';l.textContent='üìç '+(k.lokasi||'');p.appendChild(l);
        const link=document.createElement('a');link.className='btn';link.href=k.mapUrl||'#';link.textContent='Lihat Lokasi/Link';if(/^https?:/i.test(link.href)){link.target='_blank';link.rel='noopener'};p.appendChild(link);
        card.appendChild(p);wrap.appendChild(card);
      });
    }

    async function initData(){
      const [aRes, kRes] = await Promise.allSettled([
        fetchCSV(ARTICLES_CSV_URL),
        fetchCSV(KAJIAN_CSV_URL)
      ]);

      let arts = [];
      if(aRes.status==='fulfilled'){
        try{ arts = aRes.value.map(normalizeArticleRow).filter(x=>x.title||x.href); }catch(_){}
      }
      let kajs = [];
      if(kRes.status==='fulfilled'){
        try{ kajs = kRes.value.map(normalizeKajianRow).filter(x=>x.judul); }catch(_){}
      }

      if(arts.length){ renderArticles(arts); }
      else{ const wrap=document.getElementById('articles'); if(wrap) wrap.innerHTML='<div class="card"><div class="p muted">Belum ada artikel / gagal memuat.</div></div>'; }

      if(kajs.length){ renderKajian(kajs); }
      else{ const wrap=document.getElementById('kajians'); if(wrap) wrap.innerHTML='<div class="card"><div class="p muted">Belum ada data kajian / gagal memuat.</div></div>'; }

      await loadInfos();
    }
    initData();

    // VIDEO TERBARU GRID
    async function fetchYouTubeRSS(){
      const res = await fetch(RSS2JSON + encodeURIComponent(FEED) + `&_=${Date.now()}`);
      const data = await res.json();
      if(!data || !Array.isArray(data.items)) return [];
      return data.items.map(it=>{
        const id = (it.link.split("v=")[1]||"").slice(0,11);
        return { id, title: it.title||"", published:new Date(it.pubDate||Date.now()), link: it.link||`https://www.youtube.com/watch?v=${id}`, thumb: it.thumbnail||`https://i.ytimg.com/vi/${id}/hqdefault.jpg` };
      }).sort((a,b)=>b.published-a.published);
    }
    function renderVideosHome(list){
      const wrap=document.getElementById('videosHome'); wrap.innerHTML='';
      const show = list.slice(0, INFO_HIGHLIGHT_COUNT);
      if(!show.length){wrap.innerHTML='<div class="card"><div class="p muted">Gagal memuat video.</div></div>';return}
      show.forEach(v=>{
        const a=document.createElement('a'); a.className='card'; a.href=v.link; a.target='_blank'; a.rel='noopener';
        const p=document.createElement('div'); p.className='p';
        p.innerHTML = `<div class="video-thumb"><img src="${v.thumb}" alt=""></div><h3 style="margin:.6rem 0 .3rem">${v.title}</h3><div class="muted">${v.published.toLocaleDateString('ja-JP',{year:'numeric',month:'short',day:'numeric'})}</div>`;
        a.appendChild(p); wrap.appendChild(a);
      });
    }
    (async ()=>{ try{ const vids=await fetchYouTubeRSS(); renderVideosHome(vids);} catch(e){ console.error(e); document.getElementById('videosHome').innerHTML='<div class="card"><div class="p muted">Gagal memuat video.</div></div>'; }})();
  </script>
</body>
</html>
